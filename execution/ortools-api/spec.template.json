{
  "$schema": "./dsl.schema.json",
  "spec_version": "1.0",
  "meta": {
    "name": "Turnistica - template",
    "notes": "Compila sets, shifts, employees, demand e constraints. Poi POST /validate e POST /jobs."
  },

  "sets": {
    "employees": ["E1", "E2", "E3"],
    "days": ["2026-03-02", "2026-03-03", "2026-03-04"],
    "shifts": ["M", "S", "OFF"],
    "sites": ["SITE_A"],

    "skills": ["certified"],
    "roles": ["cleaner", "team_lead"]
  },

  "groups": {
    "certified_team": ["E1", "E2"]
  },

  "shifts": {
    "M": { "start": "07:00", "end": "15:00", "minutes": 480, "is_work": true },
    "S": { "start": "15:00", "end": "23:00", "minutes": 480, "is_work": true },
    "OFF": { "start": "00:00", "end": "00:00", "minutes": 0, "is_work": false }
  },

  "employees": {
    "E1": { "skills": ["certified"], "roles": ["team_lead"], "site_home": "SITE_A", "contract": { "type": "full_time" } },
    "E2": { "skills": ["certified"], "roles": ["cleaner"], "site_home": "SITE_A", "contract": { "type": "full_time" } },
    "E3": { "skills": [], "roles": ["cleaner"], "site_home": "SITE_A", "contract": { "type": "part_time" } }
  },

  "demand": [
    {
      "day": "2026-03-02",
      "site": "SITE_A",
      "shift": "M",
      "min": 2,
      "max": 2,
      "requirements": {
        "skills_min": [{ "skill": "certified", "min": 1 }],
        "roles_min": [{ "role": "team_lead", "min": 1 }]
      }
    },
    {
      "day": "2026-03-02",
      "site": "SITE_A",
      "shift": "S",
      "min": 1,
      "max": 1,
      "requirements": {
        "skills_min": [{ "skill": "certified", "min": 1 }]
      }
    }
  ],

  "constraints": [
    {
      "id": "C1_ASSIGNMENT",
      "type": "hard",
      "kind": "exactly_one_assignment_per_day",
      "scope": { "employees": "ALL" },
      "data": { "shifts": ["M", "S", "OFF"] }
    },

    {
      "id": "C2_NO_S_TO_M",
      "type": "hard",
      "kind": "forbid_shift_sequences",
      "scope": { "employees": "ALL" },
      "data": {
        "forbidden_pairs": [
          { "prev_shift": "S", "next_shift": "M" }
        ]
      }
    },

    {
      "id": "C3_MAX_WORKDAYS_7",
      "type": "hard",
      "kind": "max_shifts_in_window",
      "scope": { "employees": "ALL" },
      "data": { "window_days": 7, "shifts": ["M", "S"], "max": 5, "mode": "rolling" }
    },

    {
      "id": "S1_AVOID_WEEKEND_E3",
      "type": "soft",
      "kind": "penalize_work_on_days",
      "scope": { "employees": ["E3"] },
      "data": { "days": ["2026-03-02"], "working_shifts": ["M", "S"] },
      "penalty": { "weight": 10 }
    },

    {
      "id": "S2_FAIR_SERALI",
      "type": "soft",
      "kind": "fair_distribution",
      "scope": { "employees": "ALL" },
      "data": {
        "measure": "count",
        "shifts": ["S"],
        "window_days": 7,
        "target": "auto_mean",
        "penalize": "absolute_deviation"
      },
      "penalty": { "weight": 5 }
    }
  ],

  "objective": {
    "mode": "minimize",
    "terms": [{ "kind": "soft_penalties_total", "weight": 1 }]
  }
}